<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Extending with Plugins</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/booklit.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab|Source+Code+Pro:400,600|Lora:400,400i" rel="stylesheet" />
  </head>
  <body>
    <div class="side">
      

<div class="context">
  <nav>
    <div class="top">
      
<a href="index.html" >Booklit</a>

    </div>

    
    <input type="checkbox" class="toggle" checked />
    <span class="arrow"></span>
    <div class="children">
      <table>
      
        <tr>
          <td class="number-cell" align="right">1&nbsp;</td>
          <td class="title-cell">
<a href="getting-started.html" >Getting Started</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">2&nbsp;</td>
          <td class="title-cell">
<a href="baselit.html" >The <code>baselit</code> Plugin</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">3&nbsp;</td>
          <td class="title-cell">
<a href="html-renderer.html" >The HTML Renderer</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">4&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html"  class="self">Extending with Plugins</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">5&nbsp;</td>
          <td class="title-cell">
<a href="syntax.html" >Document Syntax</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">6&nbsp;</td>
          <td class="title-cell">
<a href="thanks.html" >Thanks</a>
</td>
        </tr>
      
      </table>
    </div>
    
  </nav>
</div>


<div class="context">
  <nav>
    <div class="top">
      4&nbsp;
<a href="plugins.html"  class="self">Extending with Plugins</a>

    </div>

    <input type="checkbox" class="toggle" checked />
    <span class="arrow"></span>
    <div class="children">
      <table>
      
        <tr>
          <td class="number-cell" align="right">4.1&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#get-going" >Get Going</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">4.2&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#using-plugins" >Using Plugins</a>
</td>
        </tr>
      
        <tr>
          <td class="number-cell" align="right">4.3&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#using-plugins" >Writing Plugins</a>
</td>
        </tr>
      
      </table>
    </div>
  </nav>
</div>



<div class="context">
  <div class="top">
    On this page:
  </div>

  <nav>
    <div class="children">
      <table>
        
        
        <tr>
          <td class="number-cell" align="right">4.1&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#get-going" >Get Going</a>
</td>
        </tr>
          
        
        <tr>
          <td class="number-cell" align="right">4.2&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#using-plugins" >Using Plugins</a>
</td>
        </tr>
          
        
        <tr>
          <td class="number-cell" align="right">4.3&nbsp;</td>
          <td class="title-cell">
<a href="plugins.html#using-plugins" >Writing Plugins</a>
</td>
        </tr>
          
        
      </table>
    </div>
  </nav>
</div>

    </div>
    <div class="page">
      <h1 class="section-header"><a name="plugins"></a><span class="section-number">4 </span>Extending with Plugins</h1>

<p>Plugins are what provide the functionality behind function calls like <code>\foo{bar}</code>. Out of the box, Booklit comes with a plugin called <a href="baselit.html"><code>baselit</code></a> which provides basic primives like <a href="baselit.html#title"><code>\<strong>title</strong></code></a> and <a href="baselit.html#section"><code>\<strong>section</strong></code></a> in addition to support for basic markup like <a href="baselit.html#italic"><code>\<strong>italic</strong></code></a> and <a href="baselit.html#bold"><code>\<strong>bold</strong></code></a>. It also serves as a good reference when writing your own plugin.</p>


  
    <h2 class="section-header"><a name="get-going"></a><span class="section-number">4.1 </span>Get Going</h2>

<p>Plugins are implemented in the <a href="https://golang.org">Go programming language</a>, so if you&#39;re planning on writing or using one, make sure you&#39;ve got it installed.</p><p>First you&#39;ll need to get your <code>$GOPATH</code> sorted out. By default, Go sets this value to <code>~/go</code>, but if that&#39;s not sufficient you can set it to something else. This is the path under which Go source code and compiled binaries will live.</p><p>One suggestion: you may want to set the root of your Booklit content as your <code>$GOPATH</code>, so that your content can live alongside its plugins, whether they&#39;re all third-party or whether you&#39;ll be writing some yourself.</p><p>For starters, let&#39;s fetch Booklit itself into your <code>$GOPATH</code>:</p><p><pre class="highlight"><span></span>go get github.com/vito/booklit
</pre></p><p>This fetch is necessary even if you already have the <code>booklit</code> binary installed, as plugins make use of Booklit&#39;s Go API.</p>


  

  
    <h2 class="section-header"><a name="using-plugins"></a><span class="section-number">4.2 </span>Using Plugins</h2>

<p>To use a plugin, you&#39;ll need to pass its Go import path to the <code>booklit</code> command when building your docs via the <code>--plugin</code> flag, like so:</p><p><pre class="highlight"><span></span>booklit -i index.lit -o out <span class="se">\</span>
    --plugin my/fancyplugin
</pre></p><p>The plugin will then be pulled in at runtime, and it will register itself under a certain name (conventionally, the same name as its package). Next, execute <a href="baselit.html#use-plugin"><code>\<strong>use-plugin</strong></code></a> in your <code>.lit</code> document to add it to the section:</p><p><pre class="highlight"><span></span><span class="k">\title</span><span class="nb">{</span>My Section<span class="nb">}</span>

<span class="k">\use-plugin</span><span class="nb">{</span>fancyplugin<span class="nb">}</span>

Blah blah.
</pre></p><p>The <code>--plugin</code> flag can be specified multiple times, and <a href="baselit.html#use-plugin"><code>\<strong>use-plugin</strong></code></a> can be invoked multiple times.</p>


  

  
    <h2 class="section-header"><a name="using-plugins"></a><span class="section-number">4.3 </span>Writing Plugins</h2>

<p>To write a new plugin, first you&#39;ll need to create a directory for your plugin&#39;s package in your <code>$GOPATH</code>. Let&#39;s just call it something cute like <code>pluglit</code>.</p><p><pre class="highlight"><span></span>mkdir <span class="nv">$GOPATH</span>/src/pluglit
</pre></p><p>Then, we&#39;ll create the initial skeleton for our plugin at <code>$GOPATH/src/pluglit/plugin.go</code>:</p><p><pre class="highlight"><span></span><span class="kn">package</span> <span class="nx">pluglit</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;github.com/vito/booklit&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">booklit</span><span class="p">.</span><span class="nx">RegisterPlugin</span><span class="p">(</span><span class="s">&quot;pluglit&quot;</span><span class="p">,</span> <span class="nx">NewPlugin</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">NewPlugin</span><span class="p">(</span><span class="nx">sec</span> <span class="o">*</span><span class="nx">booklit</span><span class="p">.</span><span class="nx">Section</span><span class="p">)</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Plugin</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">Plugin</span><span class="p">{</span>
    <span class="nx">section</span><span class="p">:</span> <span class="nx">sec</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Plugin</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">section</span> <span class="o">*</span><span class="nx">booklit</span><span class="p">.</span><span class="nx">Section</span>
<span class="p">}</span>
</pre></p><p>This registers a plugin that effectively does nothing. But it does it well.</p><p>Let&#39;s define some document functions! Functions work by simply defining methods on the plugin. Let&#39;s define a basic one with no arguments:</p><p><pre class="highlight"><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">plugin</span> <span class="nx">Plugin</span><span class="p">)</span> <span class="nx">HelloWorld</span><span class="p">()</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Content</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></p><p>Now let&#39;s create a Booklit document that uses it as <code>hello-plugins.lit</code>:</p><p><pre class="highlight"><span></span><span class="k">\use-plugin</span><span class="nb">{</span>pluglit<span class="nb">}</span>

Zero args: <span class="k">\hello-world</span>
</pre></p><p>And build it like so:</p><p><pre class="highlight"><span></span>booklit -i hello-plugins.lit -o out <span class="se">\</span>
    --plugin pluglit
</pre></p><p>This should result in a page showing:</p><div style="margin: 0 2em 1em" class="inset"><p>Zero args: Hello, world!</p></div>


  
    <h3 class="section-header"><a name="argument-types"></a><span class="section-number">4.3.1 </span>Argument Types</h3>

<p>Functions can be invoked with any number of arguments, like so:</p><p><pre class="highlight"><span></span><span class="k">\hello-world</span><span class="nb">{</span>arg1<span class="nb">}{</span>arg2<span class="nb">}</span>
</pre></p><p>See <a href="syntax.html#function-syntax">Function Syntax</a> for more information.</p><p>Each argument to the function corresponds to an argument for the plugin&#39;s method, which may be variadic.</p><p>The plugin&#39;s arguments must each be one of the following types:</p><dl>
  
  <dt><a href="https://godoc.org/github.com/vito/booklit#Content"><code>booklit.<strong>Content</strong></code></a></dt>
    <dd><p>The evaluated content. This can be just about anything from a word to a sentence to a series of paragraphs, depending on how the function is invoked. It is typically used unmodified.</p></dd>
  
  <dt><code>string</code></dt>
    <dd><p>The evaluated content, converted into a string. This is useful when the content is expected to be something simple, like a word or line of text. The <a href="baselit.html#title"><code>\<strong>title</strong></code></a> function, for example, uses this type for its variadic <em>tags</em> argument.</p></dd>
  
  <dt><a href="https://godoc.org/github.com/vito/booklit/ast#Node"><code>booklit/ast.<strong>Node</strong></code></a></dt>
    <dd><p>The unevaluated syntax tree for the content. This is useful when doing meta-level things like <a href="baselit.html#section"><code>\<strong>section</strong></code></a> which need to control the evaluation context of the content.</p></dd>
  
</dl>


  

  
    <h3 class="section-header"><a name="return-values"></a><span class="section-number">4.3.2 </span>Return Values</h3>

<p>Plugin methods can then return one of the following:</p><ul>

  <li><p>nothing</p></li>

  <li><p><code>error</code></p></li>

  <li><p><a href="https://godoc.org/github.com/vito/booklit#Content"><code>booklit.<strong>Content</strong></code></a></p></li>

  <li><p><code>(<a href="https://godoc.org/github.com/vito/booklit#Content"><code>booklit.<strong>Content</strong></code></a>, error)</code></p></li>

</ul><p>If a method returns a non-nil <code>error</code> value, it will bubble up and the building will fail.</p>


  

  
    <h3 class="section-header"><a name="a-full-example"></a><span class="section-number">4.3.3 </span>A Full Example</h3>

<p>Putting the pieces together, let&#39;s extend our <code>pluglit</code> plugin from earlier write a real function that does something useful:</p><p><pre class="highlight"><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">plugin</span> <span class="nx">Plugin</span><span class="p">)</span> <span class="nx">DescribeFruit</span><span class="p">(</span>
  <span class="nx">name</span> <span class="kt">string</span><span class="p">,</span>
  <span class="nx">definition</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span>
  <span class="nx">tags</span> <span class="o">...</span><span class="kt">string</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="nx">booklit</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;name cannot be blank&quot;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">content</span> <span class="o">:=</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">{}</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">tags</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tag</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tags</span> <span class="p">{</span>
    <span class="nx">content</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Target</span><span class="p">{</span>
      <span class="nx">TagName</span><span class="p">:</span> <span class="nx">tag</span><span class="p">,</span>
      <span class="nx">Display</span><span class="p">:</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="nx">name</span><span class="p">),</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">content</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">Paragraph</span><span class="p">{</span>
    <span class="nx">booklit</span><span class="p">.</span><span class="nx">Styled</span><span class="p">{</span>
      <span class="nx">Style</span><span class="p">:</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">StyleBold</span><span class="p">,</span>
      <span class="nx">Content</span><span class="p">:</span> <span class="nx">booklit</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="nx">name</span><span class="p">),</span>
    <span class="p">},</span>
  <span class="p">})</span>

  <span class="nx">content</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">content</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></p><p>There are many things to note here:</p><ul>

  <li><p>there are two required arguments; <em>name</em> is a <code>string</code> and <em>value</em> is a <a href="https://godoc.org/github.com/vito/booklit#Content"><code>booklit.<strong>Content</strong></code></a></p></li>

  <li><p>there&#39;s a variadic argument, <em>tags</em>, which is of type <code>[]string</code></p></li>

  <li><p>this function generates content, and can raise an error when building</p></li>

  <li><p>the <a href="https://godoc.org/github.com/vito/booklit#Target"><code>booklit.<strong>Target</strong></code></a> elements will result in tags being registered in the section the function is called from</p></li>

  <li><p>the function name, <code>describe-fruit</code>, corresponds to the method name <code>DescribeFruit</code></p></li>

</ul><p>This function would be called like so:</p><p><pre class="highlight"><span></span><span class="k">\describe-fruit</span><span class="nb">{</span>banana<span class="nb">}{</span>
  A banana is a yellow fruit that only really tastes
  good in its original form. Banana flavored
  anything is a pit of dispair.
<span class="nb">}{</span>banana-opinion<span class="nb">}</span>
</pre></p><p>...and will result in something like the following:</p><div style="margin: 0 2em 1em" class="inset"><a name="banana-opinion"></a><p><strong>banana</strong></p><p>A banana is a yellow fruit that only really tastes good in its original form. Banana flavored anything is a pit of dispair.</p></div><p>...which can be referenced as <code>\reference{banana-opinion}</code>, which results in a link like this: <a href="plugins.html#banana-opinion">banana</a>.</p>


  

  

  

    </div>
    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-103006155-1', 'auto');
ga('send', 'pageview');
    </script>
  </body>
</html>